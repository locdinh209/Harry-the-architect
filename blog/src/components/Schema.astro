---
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

interface Props {
	type?: 'website' | 'article';
	title?: string;
	description?: string;
	image?: string;
	pubDate?: Date;
	updatedDate?: Date;
}

const { 
	type = 'website',
	title = SITE_TITLE,
	description = SITE_DESCRIPTION,
	image = '/Harry-the-architect/blog-placeholder-1.jpg',
	pubDate,
	updatedDate
} = Astro.props;

const canonicalURL = new URL(Astro.url.pathname, Astro.site);
const siteUrl = Astro.site?.toString();
const baseUrl = import.meta.env.BASE_URL;

// 1. PERSON ENTITY (The Authority)
const harrySchema = {
	"@type": "Person",
	"@id": `${siteUrl}#harry`,
	"name": "Harry Dinh",
	"url": siteUrl,
	"jobTitle": "AI Architect",
	"description": "Architect building intelligent systems with Multi-Agent AI, Cloud Architecture, and Enterprise Data.",
	"image": new URL(`${baseUrl}blog-placeholder-about.jpg`, Astro.site).toString(),
	"sameAs": [
		"https://github.com/locdinh209",
		"https://www.linkedin.com/in/harrydinh/" 
	]
};

// 2. BREADCRUMB LIST (The Structure)
const breadcrumbSchema = {
	"@type": "BreadcrumbList",
	"itemListElement": [
		{
			"@type": "ListItem",
			"position": 1,
			"name": "Home",
			"item": siteUrl
		},
		{
			"@type": "ListItem",
			"position": 2,
			"name": "Blog",
			"item": new URL(`${baseUrl}blog/`, Astro.site).toString()
		}
	]
};

if (type === 'article') {
	// Add current article to breadcrumbs
	breadcrumbSchema.itemListElement.push({
		"@type": "ListItem",
		"position": 3,
		"name": title,
		"item": canonicalURL.toString()
	});
}

let schema;

if (type === 'article') {
	// 3. TECH ARTICLE (The Content) - Specificity Win
	schema = {
		"@context": "https://schema.org",
		"@graph": [
			harrySchema,
			breadcrumbSchema,
			{
				"@type": "TechArticle",
				"mainEntityOfPage": {
					"@type": "WebPage",
					"@id": canonicalURL.toString()
				},
				"headline": title,
				"description": description,
				"image": new URL(image, Astro.url).toString(),
				"author": { "@id": `${siteUrl}#harry` },
				"datePublished": pubDate?.toISOString(),
				"dateModified": updatedDate?.toISOString() || pubDate?.toISOString(),
				"proficiencyLevel": "Expert", 
				"publisher": {
					"@type": "Organization",
					"name": SITE_TITLE,
					"logo": {
						"@type": "ImageObject",
						"url": new URL('favicon.svg', Astro.url).toString() 
					}
				}
			}
		]
	};
} else {
	// 4. WEBSITE (The Hub)
	schema = {
		"@context": "https://schema.org",
		"@graph": [
			harrySchema,
			breadcrumbSchema,
			{
				"@type": "WebSite",
				"url": siteUrl,
				"name": SITE_TITLE,
				"description": SITE_DESCRIPTION,
				"author": { "@id": `${siteUrl}#harry` },
				"potentialAction": {
					"@type": "SearchAction",
					"target": {
						"@type": "EntryPoint",
						"urlTemplate": `${siteUrl}?q={search_term_string}`
					},
					"query-input": "required name=search_term_string"
				}
			}
		]
	};
}
---

<script type="application/ld+json" set:html={JSON.stringify(schema)} />
